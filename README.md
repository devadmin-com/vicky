# Vicky
Vicky is a robot which sends JIRA activity to relevant slack 
intelligently mapping JIRA task projects, lables and assignee to slack channels 
and people.

# Building, Installing, Running
## Requirements
* Java 8 or higher
* gradle 4.10.2 or higher

## How to run & modify
  - clone the project
  - open it with Intellij Idea
  - Go to File > Project Structure > Modules
  - import projects **jira, slack and vicky** as *gradle* projects
  - Go to *gradle* panel of your ide and execute **clean, build, install** for each module
(jira, slack, vicky)

### Important: application.yml !!
  - Configure *application.yml* file instead of *sample-application.yml* 
  
### Hint: Running local machine for testing.
  - Use [Ngrok](https://ngrok.com) to test webhook integrations on your local machine if you do not have a static IP with following command @todo - what is it?
  - Put *url* generated by *Ngrok* as webhook in jira settings

# Features
### JIRA Project -> slack channel mapping
Each JIRA project maps to one slack channel for sending notifications. 
Slack channel and jira project name have to be the same.
(convention over configuration)

### Username mapping
Users need to have the same name on slack & jira

## JIRA Event Messages to Slack Channels
On Create, resolve send updates to project channel as described below:
### Type = "DEFAULT" (anything not specified Below)
```
:rocket: <Number> (clickable URL) <Status>: <Summary> @<assignee nickname>
<commenter id> ➠ <last comment>
```
### Type = “Server”
```
:hammer_and_wrench: <Number> (clickable URL) <Status>: <Summary> @<assignee nickname>
<commenter id> ➠ <last comment>
```
### Type = ”Operations” tickets
```
⚙ <Number> (clickable URL) <Status>: <Summary> @<assignee nickname>
<commenter id> ➠ <last comment>
```
### Type =”Urgent bug” tickets
```
⚡<Number> (clickable URL) <Status>: <Summary> @<assignee nickname>
<commenter id> ➠ <last comment>
```

### Priority=Blocker tickets (any type)
```
‼️ <Number> (clickable URL) <Status>: <Summary> @<assignee nickname>
<commenter id> ➠ <last comment>
```


## JIRA Event Messages to Slack DM
### @reference to me in comment
When a user is referenced in a comment send them a message on the private channel as follows:
```
<ticket type icon> <Number (clickable URL)> <Status>: <Summary> 
<commenter name> ➠ <last comment>
```
### Ticket assigned to you, send update as:
```
<Name user who assigned> assigned to you: <type icon ⚙⚡> <Number (clickable URL)> <Status>: <Summary> 
<commenter id> ➠ <last comment>
```

### priority=blocker task assigned to you not commented in 24 hours
Keep on re-bugging about this every 6 hours - so get message at 24, 30, 36, 42… hours after no comment.

### someone comments on task assigned to user, send update as:
```
<type icon ⚙⚡> <Number (clickable URL)> <Status>: <Summary> 
<commenter id> ➠ <last comment>
```

## Slack Message Processing

### ticket info expansion in chats
When Users write a ticket number in slack the summary info for that ticket is displayed
Basically we want the https://www.nextup.ai/ functionality - we were using it before but now it processes Vicky’s messages… Another option would be to figure out how to make nextup not read Vicky’s messages…
```
<type icon ⚙⚡❗️> <Number (clickable URL)> <Status>: <Summary> 
<description - first 5 lines>
<commenter name> ➠ <last comment>
```

## General

### Comment display truncating
Truncate display of comments to 256 unicode characters

### Icons indicating ticket type
 -    We use these in display as follows:
 -   ⚙ Type = ”Operations” tickets
 -   ⚡ Type =”Urgent bug” tickets
 -   ❗️ Priority=Blocker tickets (any type)


# Enjoy ;)
